#!/bin/bash

## package installation
add-apt-repository ppa:wireguard/wireguard
apt-get update -q -y
apt-get -q -y install wireguard

#copy templated wireguard conf file to expected location
cp -f /var/vcap/jobs/wireguard/config/wg0.conf /etc/wireguard

<% if_p('wireguard.debug') do |value| %>
modprobe wireguard && echo module wireguard +p > /sys/kernel/debug/dynamic_debug/control
<% end %>

#start the interface
wg-quick up wg0

exit 0
